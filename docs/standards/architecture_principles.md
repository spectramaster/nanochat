# 架构原则与规范草案

## 架构原则
1. **分层清晰**：按照核心模型、数据管线、运行时调度、配置管理、接口展现划分目录，每层仅通过明确定义的接口进行交互。
2. **单一职责**：每个模块仅承担一个清晰职责，通用能力下沉至 `nanochat.utils`。
3. **依赖反转**：高层模块依赖抽象协议而非具体实现，便于替换模型、优化器或数据源。
4. **配置集中**：所有运行参数通过结构化配置统一管理，支持类型校验与默认值兜底。
5. **可测试性**：模块需要提供可注入依赖与 Mock 支持，确保单元测试和集成测试易于编写。
6. **文档同步**：任何接口或行为变化必须更新 API 与用户文档，保持可追溯性。

## 代码规范
- 采用 `ruff`、`mypy`、`pytest` 作为基础质量工具；
- 模块命名使用小写加下划线，类名使用帕斯卡命名，函数使用动词短语；
- 重要函数、类须提供类型注解与 docstring；
- 日志输出统一由 `nanochat.utils.logging` 管理，禁止直接使用 `print`（除 `print0` 兼容接口）；
- 异常需要使用项目内自定义异常体系，禁止静默吞掉异常。

## 文档规范
- `docs/` 目录按照主题存放，新增文档需在 `docs/README.md` 中登记；
- 采用「背景 → 设计 → 使用方式 → 注意事项」结构书写技术文档；
- 用户手册需提供中文版本，并给出快速开始与常见问题。

## 审核流程
1. 任何 PR 必须通过自动化测试与静态检查；
2. 变更需更新对应文档并在 PR 描述中列出；
3. 核心模块变更需至少一名维护者评审通过；
4. 定期（每两周）复盘规范执行情况并更新文档。
